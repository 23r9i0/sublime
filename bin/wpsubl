#!/bin/bash

wp_dir="$(pwd)"

if [[ ! -f "$wp_dir/wp-config.php" ]]; then
  echo "This script run only inside root directory of WordPress Install"
  exit
fi

function wp_subl_update() {
  wp subl create $wp_dir --user=$1
}
function wp_subl_package() {
  local wp_type_completion

  echo "Select type of completions: (Default: first option)"
  # echo "Type multiple options separate for one space"
  echo "1. All"
  echo "2. Constants"
  echo "3. Capabilities"
  echo "4. Functions"
  echo "5. Hooks, both Actions and Filters"
  echo "6. Actions"
  echo "7. Filters"
  echo "8. Classes"
  echo ""
  read -p "Type: " wp_type_completion
  [ "" != "$wp_type_completion" ] || wp_type_completion=1
  case $wp_type_completion in
    1|2|3|4|5|6|7|8 )
      wp subl pkg "$1" --type=$wp_type_completion
      ;;
    * )
      if [[ "" != $2 ]]; then
        echo "Undefined option"
        wp_subl_package $1
      else
        exit
      fi
      ;;
  esac

  if [[ "1" != "$wp_type_completion" ]]; then
    read -p "Export another? (y|n): " export_another
    case "$export_another" in
      "y" )
          wp_subl_package $1 "initial"
          ;;
      * )
        select_type_script
        ;;
    esac
  fi

}
function select_type_script() {
  echo "Define the type of run script"
  echo "1. Create:  Run scripts Update and Package"
  echo "2. Update:  Update or Create posts in WordPress Installation"
  echo "3. Package: Generate Sublime Text Completions"
  echo "4. Exit"

  read -p "Enter number [ 1 - 4 ]: " choice
  case $choice in
    1 )
      wp_subl_update $1
      wp_subl_package $2 "initial"
      ;;
    2 )
      wp_subl_update $1
      ;;
    3 )
      wp_subl_package $2 "initial"
      ;;
    4 )
      echo "Exit"
      exit
      ;;
    * )
      echo "Undefined option"
      exit
      ;;
  esac
}

function main() {
  local wp_user=1
  local wp_install_subl="${HOME}/.config/sublime-text-3/Packages/sublime-text-wordpress/completions"

  read -p "Run defaults? (y|n|h): " default_options
  case "$default_options" in
    h )
      echo ""
      echo "###################################################################################"
      echo "#  Defaults #######################################################################"
      echo "###################################################################################"
      echo "#                                                                                 #"
      echo "#  User ID: 1                                                                     #"
      echo "#  Directory to export: ~/.config/sublime-text-3/Packages/sublime-text-wordpress  #"
      echo "#                                                                                 #"
      echo "###################################################################################"
      echo "#  Custom selections ##############################################################"
      echo "###################################################################################"
      echo "#                                                                                 #"
      echo "#  User: your user id or login name, default User ID "1"                          #"
      echo "#  Directory to export: your directory                                            #"
      echo "#                                                                                 #"
      echo "#  This script verifies that the directory exists                                 #"
      echo "#  and asks if you want to continue                                               #"
      echo "#                                                                                 #"
      echo "###################################################################################"
      echo ""
      main
    ;;
    y )
      ;;
    n )
      echo "Define your user"
      read -p "User ID or login name: " wp_custom_user
      if [[ "" != "$wp_custom_user" ]]; then
        wp_user=$wp_custom_user
      fi

      echo "Define directory to create WordPress Sublime Completions"
      read -p "Directory: " wp_custom_install_subl
      if [[ -d "$wp_custom_install_subl" ]]; then
        wp_install_subl=$wp_custom_install_subl
      else
        echo "Directory not exists!!!"
        read -p "You want to continue? (y|n): " create_directory
        case $create_directory in
          y )
            wp_install_subl=$wp_custom_install_subl
            ;;
          * )
            exit
            ;;
        esac
      fi
      ;;
    * )
      exit
      ;;
  esac

  echo $wp_install_subl
  select_type_script $wp_user $wp_install_subl
}

main
exit